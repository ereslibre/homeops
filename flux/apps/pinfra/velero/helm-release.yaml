apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: velero
  namespace: velero
spec:
  chart:
    spec:
      version: "=6.0.0"
  install:
    remediation:
      retries: -1
    replace: true
  upgrade:
    remediation:
      retries: -1
  values:
    image:
      tag: v1.13.1
    configuration:
      backupStorageLocation:
      - provider: velero.io/aws
        bucket: pinfra-backup
        credentials:
          name: credentials
        config:
          region: eu-west-1
      volumeSnapshotLocation:
      - provider: velero.io/aws
        config:
          region: eu-west-1
    initContainers:
    - name: velero-plugin-for-aws
      image: velero/velero-plugin-for-aws:v1.9.0
      imagePullPolicy: IfNotPresent
      volumeMounts:
        - mountPath: /target
          name: plugins
